# 最佳实践

------

- [最佳实践](#最佳实践)
  - [在编写生产代码时，应该遵循如下指导方针。](#在编写生产代码时应该遵循如下指导方针)
  - [SQL 优化](#sql-优化)
    - [可能会导致慢查询的原因及建议](#可能会导致慢查询的原因及建议)
    - [相关工具](#相关工具)


------


## 在编写生产代码时，应该遵循如下指导方针。

- 获取单条记录时，要多用 first 方法，尽量不要用 fetchone 和 scalar 方法，因为对程序员来说，first 方法更加清晰。
- 尽量使用可迭代对象 ResultProxy，而不要用 fetchall 和 fetchone 方法，因为前者的内存效率更高，而且我们往往一次只对一条记录进行操作。
- 避免使用 fetchone 方法，因为如果不小心，它会一直让连接处于打开状态。
- 谨慎使用 scalar 方法，因为如果查询返回多行多列，就会引发错误，多行多行在测试过程中经常会丢失。

## SQL 优化

Parsing-Binding-Optimization-Execution

### 可能会导致慢查询的原因及建议
- join和where条件中存在函数
- 触发了隐式转换
- 查询条件中存在OR -> 最好可以分开查询
- 使用了%LIKE%查询 -> 根据条件尽量使用%LIKE, LIKE%以使用索引
- 大批量写入（会导致锁表）
- 缺失索引
- 多表合并
- Query Hints

### 相关工具
- 执行计划
- 统计IO
- 执行耗时
