# awk

------

- [awk](#awk)
  - [简介](#简介)
  - [基本语法](#基本语法)
    - [内建变量](#内建变量)
    - [模式](#模式)
  - [示例](#示例)

------

## 简介

awk是一种编程语言，用于在linux/unix下对文本和数据进行处理。

## 基本语法

``` sh
awk 'pattern {action}'
```

### 内建变量

| 条件     | 解释                                                                          |
| :------- | :---------------------------------------------------------------------------- |
| $0       | 当前记录（这个变量中存放着整个行的内容）                                      |
| $n       | 当前记录的第n个字段，字段间由FS分隔                                           |
| FS       | 输入字段分隔符 默认是空格或Tab                                                |
| NF       | 当前记录中的字段个数，就是有多少列                                            |
| NR       | 已经读出的记录数，就是行号，从1开始，如果有多个文件话，这个值也是不断累加中。 |
| FNR      | 当前记录数，与NR不同的是，这个值会是各个文件自己的行号                        |
| RS       | 输入的记录分隔符， 默认为换行符                                               |
| OFS      | 输出字段分隔符， 默认也是空格                                                 |
| ORS      | 输出的记录分隔符，默认为换行符                                                |
| FILENAME | 当前输入文件的名字                                                            |


### 模式

| 模式       | 解释               | 举例                 |
| :--------- | :----------------- | :------------------- |
| 正则表达式 | 使用通配符的扩展集 | /abc/  ， $1 ~ /abc/ |
| 比较表达式 | 满足条件的行，     | $2>$1                |
| 常量表达式 | 0为假，非0为真     | 1                    |
| BEGIN      | 开始               |                      |
| END        | 结束               |                      |
| 模式范围   | begpat, endpat     | 模式1~模式2          |


## 示例

``` ssh
# 条件聚合
cat 1.csv | awk -F ',' '$1~/[ab]/ {g[$1]+=$2*$3} END {for(l in g) printf "%s = %d\n",l,g[l]}'
```

``` ssh
# ls
awk 'BEGIN{while( "ls" | getline) print}'
```
